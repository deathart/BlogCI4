var Article=function(){var e={TitleToLink:function(){var e=$("#title"),a=$("#link");e.bind("change paste keyup",function(){for(var t=[/[\300-\306]/g,/[\340-\346]/g,/[\310-\313]/g,/[\350-\353]/g,/[\314-\317]/g,/[\354-\357]/g,/[\322-\330]/g,/[\362-\370]/g,/[\331-\334]/g,/[\371-\374]/g,/[\321]/g,/[\361]/g,/[\307]/g,/[\347]/g],i=["A","a","E","e","I","i","O","o","U","u","N","n","C","c"],n=e.val(),s=0;s<t.length;s++)n=n.replace(t[s],i[s]);n=(n=(n=n.replace(/'/g,"")).replace(/"/g,"")).replace(/ /g,"-"),a.val(n)})},AddArticle:function(){$(".add_picture_one").click(function(){$.ajax({beforeSend:function(e,a){/^(GET|HEAD|OPTIONS|TRACE)$/i.test(a.type)||e.setRequestHeader("X-CSRFToken",$('meta[name="_token"]').attr("content"))},method:"POST",url:App.GetBaseUrl()+"admin/ajax/media/modal",data:{type_modal:"add_picture_one"},dataType:"json",cache:!1,success:function(e){$("body").append(e.content),$(".modal-media_add_picture_one").modal("show"),$(".modal-media_add_picture_one").on("shown.bs.modal",function(e){$(".input-add-media").bind("change",function(){if(0!==$(this).get(0).files.length){$(".btn-add-media").css("display","block");var e=$(".input-add-media").prop("files")[0],a=new FormData;a.append("pictures",e);var t=(window.URL?URL:webkitURL).createObjectURL(e);$(".form-add-media").before('<span class="image_name">'+e.name+"</span>"),$(".form-add-media").parent(".card-body").before('<img class="card-img-top img_form_upload_card" src="'+t+'" alt="Card image cap">'),$(".form-add-media").submit(function(t){return t.preventDefault(),$.ajax({beforeSend:function(e,a){/^(GET|HEAD|OPTIONS|TRACE)$/i.test(a.type)||e.setRequestHeader("X-CSRFToken",$('meta[name="_token"]').attr("content"))},method:"POST",url:App.GetBaseUrl()+"admin/ajax/media/add",data:a,dataType:"json",cache:!1,processData:!1,contentType:!1,success:function(t){1==t.code?($(".col-add-media").after('<div class="col-sm-2">\n                        <div class="card mb-3">\n                            <img class="card-img-top" src="'+App.GetBaseUrl()+"/"+t.slug+'" alt="Card image cap">\n                            <div class="card-body">\n                                <h4 class="card-title">'+e.name+'</h4>\n                                <p class="card-text" style="text-align: center">\n                                    <span class="btn btn-secondary choice_img_add_picture_one" data-mediaid="'+t.id+'" data-mediaslug="'+App.GetBaseUrl()+"/"+t.slug+'" style="margin-left: auto;margin-right: auto;">Choisir</span>\n                                </p>\n                            </div>\n                        </div>\n                    </div>'),$(".image_name").remove(),$(".img_form_upload_card").remove(),$(".btn-add-media").css("display","none"),a.delete("pictures"),App.NotifToast("success",t.title,t.message)):App.NotifToast("error","Erreur",t.message)},error:function(e){App.NotifToast("error","Erreur",e.responseText)}}),!1})}}),$(".choice_img_add_picture_one").click(function(){$(".add_picture_one").parents(".col-sm-9").children().hasClass("sl_pic_on")&&$(".sl_pic_on").remove(),$(".add_picture_one").parents(".col-sm-9").prepend('<img data-slug="'+$(this).data("mediaslug")+'" src="'+App.GetBaseUrl()+"/"+$(this).data("mediaslug")+'" class="sl_pic_on rounded mb-2 col-sm-12" />'),$(".modal-media_add_picture_one").modal("hide")})}),$(".modal-media_add_picture_one").on("hidden.bs.modal",function(e){$(".modal-media_add_picture_one").remove()})},error:function(e){console.log(e.responseText)}})}),$(".add_article_form").submit(function(e){e.preventDefault();var a=$("#title"),t=$("#link"),i=$("#content"),n=$("#wordkey"),s=$("#cat"),d=($("#pic"),$("input[name=options]:checked").val()),o=null;return a.val()?a.addClass("is-valid"):(o=!0,a.addClass("is-invalid"),setTimeout(function(){a.removeClass("is-invalid")},1500)),t.val()?t.addClass("is-valid"):(o=!0,t.addClass("is-invalid"),setTimeout(function(){t.removeClass("is-invalid")},1500)),i.val()?i.addClass("is-valid"):(o=!0,i.addClass("is-invalid"),setTimeout(function(){i.removeClass("is-invalid")},1500)),n.val()?n.addClass("is-valid"):(o=!0,n.addClass("is-invalid"),setTimeout(function(){n.removeClass("is-invalid")},1500)),s.val()?s.addClass("is-valid"):(o=!0,s.addClass("is-invalid"),setTimeout(function(){s.removeClass("is-invalid")},1500)),null==o&&$.ajax({beforeSend:function(e,a){/^(GET|HEAD|OPTIONS|TRACE)$/i.test(a.type)||e.setRequestHeader("X-CSRFToken",$('meta[name="_token"]').attr("content"))},method:"POST",url:App.GetBaseUrl()+"admin/ajax/article/add",data:{title:a.val(),link:t.val(),content:i.val(),wordkey:n.val(),cat:s.val().join(";"),pic:$(".sl_pic_on").data("slug"),important:d},dataType:"json",cache:!1,success:function(e){(e.code=1)?(App.NotifToast("success",e.title,e.message),setTimeout(function(){window.location.href=App.GetBaseUrl()+"admin/article/edit/"+e.post_id+"/2"},3e3)):App.NotifToast("error","Erreur",e.message)},error:function(e){console.log(e.responseText)}}),!1})},EditArticle:function(){$(".update_picture_one").click(function(){$.ajax({beforeSend:function(e,a){/^(GET|HEAD|OPTIONS|TRACE)$/i.test(a.type)||e.setRequestHeader("X-CSRFToken",$('meta[name="_token"]').attr("content"))},method:"POST",url:App.GetBaseUrl()+"admin/ajax/media/modal",data:{type_modal:"picture_one"},dataType:"json",cache:!1,success:function(e){$("body").append(e.content),$(".modal-media_picture_one").modal("show"),$(".modal-media_picture_one").on("shown.bs.modal",function(e){$(".choice_img_picture_one").click(function(){$(".sl_pic_on").data("slug",$(this).data("mediaslug")).attr("src",App.GetBaseUrl()+"/"+$(this).data("mediaslug"))})}),$(".modal-media_picture_one").on("hidden.bs.modal",function(e){$(".modal-media_picture_one").remove()})},error:function(e){console.log(e.responseText)}})}),$("button.submit").click(function(e){e.preventDefault();var a=$(".edit_article_form").data("postid"),t=$("#title"),i=$("#link"),n=$("#content"),s=$("#wordkey"),d=$("#cat"),o=$(this).data("type"),l=$("input[name=options]:checked").val(),c=null;return t.val()?t.addClass("is-valid"):(c=!0,t.addClass("is-invalid"),setTimeout(function(){t.removeClass("is-invalid")},1500)),i.val()?i.addClass("is-valid"):(c=!0,i.addClass("is-invalid"),setTimeout(function(){i.removeClass("is-invalid")},1500)),n.val()?n.addClass("is-valid"):(c=!0,n.addClass("is-invalid"),setTimeout(function(){n.removeClass("is-invalid")},1500)),s.val()?s.addClass("is-valid"):(c=!0,s.addClass("is-invalid"),setTimeout(function(){s.removeClass("is-invalid")},1500)),d.val()?d.addClass("is-valid"):(c=!0,d.addClass("is-invalid"),setTimeout(function(){d.removeClass("is-invalid")},1500)),null==c&&$.ajax({beforeSend:function(e,a){/^(GET|HEAD|OPTIONS|TRACE)$/i.test(a.type)||e.setRequestHeader("X-CSRFToken",$('meta[name="_token"]').attr("content"))},method:"POST",url:App.GetBaseUrl()+"admin/ajax/article/edit",data:{postid:a,title:t.val(),link:i.val(),content:n.val(),wordkey:s.val(),cat:d.val().join(";"),pic:$(".sl_pic_on").data("slug"),important:l,type:o},dataType:"json",cache:!1,success:function(e){(e.code=1)?(App.NotifToast("success",e.title,e.message),setTimeout(function(){location.reload()},3e3)):App.NotifToast("error","Erreur",e.message)},error:function(e){console.log(e.responseText)}}),!1})},init:function(){BBCode.init(),e.TitleToLink(),e.AddArticle(),e.EditArticle()}};return e}();$(document).ready(function(){Article.init()});